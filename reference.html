<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="CLEO Redux: a new scripting runtime" />
    <meta name="author" content="Seemann" />
    <title>CLEO Redux</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Google fonts-->
    <link
      href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic"
      rel="stylesheet"
      type="text/css"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
  </head>
  <body id="page-top">
    <!-- Navigation-->
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top py-3"
      id="mainNav"
    >
      <div class="container px-4 px-lg-5">
        <a class="navbar-brand" href="index.html">CLEO Redux</a>
        <button
          class="navbar-toggler navbar-toggler-right"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ms-auto my-2 my-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html#features">Features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="reference.html">Reference</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#download">Download</a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="https://github.com/cleolibrary/CLEO-Redux/discussions"
                >Discuss</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="https://github.com/cleolibrary/CLEO-Redux"
                >GitHub</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Features-->
    <section class="page-section">
      <div class="container px-4 px-lg-5">
        <h2 class="text-center mt-0">JavaScript Reference</h2>
        <hr class="divider" />

        <div class="row gx-4 gx-lg-5">
          <div class="col-12">
            <h4 class="mb-3">Script Lifecycle</h4>

            <p>
              A file with the JavaScript code should have the
              <code>*.js</code> extension and contain known instructions as
              described below. The script may have no instructions (the empty
              script). It runs as soon as the the new game starts or a save file
              is loaded.
            </p>

            <p>
              The script terminates automatically when the last instruction has
              been executed. The runtime also terminates stuck scripts to
              prevent the game from freezing. The stuck script is the one that
              took more than <code>2</code> seconds to run since the last
              <code>wait</code> command. If that happened, check out your loops,
              some of the are missing the <code>wait</code> command.
            </p>

            <samp>
              <pre>
  while(true) {
    // meaningless infinite loop normally freezing the game
    // will be terminated after two seconds
  }
                </pre
              >
            </samp>

            <p>
              The runtime will terminate this script. To avoid that, add the
              <code>wait</code> command
            </p>

            <samp>
              <pre>
  while(true) {
    wait(250)
    // still meaningless, but does not freeze the game
  }
                </pre
              >
            </samp>
          </div>
        </div>

        <div class="row gx-4 gx-lg-5">
          <div class="col-12">
            <h4 class="mt-5 mb-3">Native Commands</h4>
            CLEO Redux supports all in-game commands (opcodes) in the class form
            as defined in
            <a href="https://library.sannybuilder.com/#/" target="_blank"
              >Sanny Builder Library</a
            >. Keywords and custom extensions are not supported.
            <br />

            <h5 class="my-3">Examples</h5>

            <div class="col-12">
              <p>
                1) If you were to
                <a
                  href="https://library.sannybuilder.com/#/gta3/default/00C0"
                  target="_blank"
                  >change the time of day</a
                >
                to 22:00, run the following command
              </p>
              <samp>
                <pre>
  Clock.SetTimeOfDay(22, 0);
                </pre>
              </samp>
              <p>
                This would be the equivalent of the opcode
                <code>00C0: set_time_of_day 22 0</code> or
                <code>SET_TIME_OF_DAY 22 0</code> in SCM code.
              </p>
            </div>

            <div class="col-12">
              <p>
                2)
                <a
                  href="https://library.sannybuilder.com/#/gta3/default/0109"
                  target="_blank"
                  >Change player's money</a
                >
              </p>
              <samp>
                <pre>
  var player = new Player(0);
  player.addScore(1000);
                </pre>
              </samp>

              <p>
                <code>new Player(0);</code> is the equivalent of getting the
                player's index using <code>$PLAYER_CHAR</code> global variable
                in Sanny Builder.
              </p>
            </div>

            <div class="col-12">
              <p>
                2) Create a dynamic entity (e.g.
                <a
                  href="https://library.sannybuilder.com/#/gta3/default/00A5"
                  target="_blank"
                  >a car</a
                >)
              </p>
              <samp>
                <pre>
    // request a model
    Streaming.RequestModel(101);

    // wait while the game loads the model
    while (!Streaming.HasModelLoaded(101)) {
      wait(250);
    }

    // create a car at the coordinates and store the handle
    var infernus = Car.Create(101, 1234.0, 567.0, -100.0);
                </pre>
              </samp>

              <p>
                <code>var infernus</code> will contain a handle of the newly
                created car. It can be passed directly to any command receiving
                the <code>Car</code> handle
              </p>

              <samp>
                <pre>
    // create a marker on the created car and store the marker handle
    var blip = Blip.AddForCar(infernus);
                </pre>
              </samp>

              <p>
                The same variable <code>infernus</code> can be used to call the
                <a
                  href="https://library.sannybuilder.com/#/gta3/classes/Car"
                  target="_blank"
                  >Car's methods</a
                >, for example, to explode the car
              </p>

              <samp>
                <pre>
    infernus.explode();
                </pre>
              </samp>

              <p>
                This would be the equivalent to the opcode
                <code>020B: explode_car $infernus</code> or
                <code>EXPLODE_CAR $infernus</code> in SCM scripts.
              </p>
            </div>

            <div class="col-12">
              <h5 class="my-3">VS Code Integration</h5>
              For better development experience use the auto-generated file
              <code>gta3.d.ts</code> or <code>vc.d.ts</code> located in
              <code>CLEO\.config</code> directory. They include all the
              necessary information on input parameters and returned values.
              <a
                href="https://github.com/cleolibrary/CLEO-Redux#integration-with-visual-studio-code"
                target="_blank"
                >See this documentation</a
              >
              on how to use <code>*.d.ts</code> with VS Code.
            </div>
          </div>
        </div>

        <div class="row gx-4 gx-lg-5">
          <div class="col-12">
            <h4 class="mt-5 mb-3">Custom Bindings</h4>
            <ul class="list-unstyled">
              <li>
                <code>GAME</code> (possible values are <code>re3</code> and
                <code>reVC</code>) - current game id<br /><br />

                <samp>
                  <pre>
    if (GAME === "re3") { showTextBox("This is re3"); } 
    if (GAME === "reVC") { showTextBox("This is reVC"); }
              </pre
                  >
                </samp>
              </li>

              <li>
                <code>log(...values)</code> - prints <code>{values}</code> to
                the cleo.log

                <samp>
                  <pre>
    var x = 1;
    log("value of x is ", x);
              </pre
                  >
                </samp>
              </li>

              <li>
                <code>wait(timeInMs)</code> - pauses the script execution for at
                least <code>{timeInMs}</code> milliseconds<br /><br />

                <samp>
                  <pre>
    while(true) {
      wait(1000);
      log("1 second passed");
    }
              </pre
                  >
                </samp>
              </li>

              <li>
                <code>isKeyPressed(vk_id)</code> - returns true if the key with
                the code <code>{vk_id}</code> is pressed.
                <a
                  href="https://docs.microsoft.com/en-us/windows/win32/inputdev/virtual-key-codes"
                  target="_blank"
                  >Virtual key-codes reference</a
                ><br /><br />

                <samp>
                  <pre>
    if (isKeyPressed(0x74)) {
      log("F5 is pressed");
    }
</pre
                  >
                </samp>
              </li>

              <li>
                <code>showTextBox(text)</code> - displays <code>{text}</code> in
                the black rectangular box<br /><br />

                <samp>
                  <pre>
    showTextBox("Hello, world!")
              </pre
                  >
                </samp>
              </li>

              <li>
                <p>
                  <s>
                    <code>op(opcode_id, ...input_args)</code> - a low-level
                    function to execute any in-game command with opcode
                    <code>{opcode_id}</code>.</s
                  >
                </p>

                <p class="text-danger">
                  <b>
                    NOTE: this command is deprecated since v0.4.0. Use the
                    classes form as described above.</b
                  >
                </p>
                <p class="text-muted">
                  For the commands that return a single value, the result is
                  this value.
                </p>

                <p class="text-muted">
                  For the commands that return multiple values, the result is an
                  object where each key corresponds to a returned value. The key
                  names match the output names given in the
                  <a href="https://library.sannybuilder.com/#/" target="_blank"
                    >command definition</a
                  >
                </p>

                <p class="text-muted">
                  For the conditional commands the result is the boolean value
                  <code>true</code> or <code>false</code><br /><br />
                </p>
                <samp>
                  <pre>
    op(0x00c0, 12, 30); // sets the time of day to 12:30

    var pos = op(0x0054, 0); // returns player 0 coordinates vector ({x, y, z});
    showTextBox("Player pos:", " x = ", pos.x, " y = ", pos.y, " z = ", pos.z);

    if (op(0x0248, 101)) { // checks the condition
      showTextBox("Model with id 101 has been loaded");
    }
              </pre
                  >
                </samp>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer-->
    <footer class="bg-light py-5">
      <div class="container px-4 px-lg-5">
        <p class="small text-center text-muted">
          CLEO Redux. Copyright &copy; 2021
          <a href="https://github.com/x87" target="_blank">Seemann</a>
        </p>
        <p class="small text-center text-muted">
          Template by
          <a href="https://startbootstrap.com/" target="_blank"
            >Start Bootstrap</a
          >
          . Photo by
          <a href="https://www.pexels.com/@ithalu" target="_blank"
            >Ithalu Dominguez</a
          >
        </p>
      </div>
    </footer>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
  </body>
</html>
